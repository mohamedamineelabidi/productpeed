# SpeedScale Sharded Cluster Architecture Diagram

## Full System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SPEEDSCALE SHARDED CLUSTER                           â”‚
â”‚                     (15 Containers + 9 Persistent Volumes)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PRESENTATION LAYER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ¨ FRONTEND (cluster-frontend)                                    â”‚   â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚   â”‚
â”‚  â”‚  Technology: React 18 + TypeScript + Vite                          â”‚   â”‚
â”‚  â”‚  Server: Nginx 1.27                                                â”‚   â”‚
â”‚  â”‚  Port: 3000 (exposed to host)                                      â”‚   â”‚
â”‚  â”‚  Features:                                                          â”‚   â”‚
â”‚  â”‚    â€¢ Product search with real-time latency visualization           â”‚   â”‚
â”‚  â”‚    â€¢ Network topology diagram (3-node architecture)                â”‚   â”‚
â”‚  â”‚    â€¢ Cache performance metrics                                     â”‚   â”‚
â”‚  â”‚    â€¢ Offline demo mode                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â”‚ HTTP Proxy                           â”‚
â”‚                                      â”‚ /backend/* â†’ api_server:8000         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            APPLICATION LAYER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸšª API GATEWAY (cluster-api-gateway) - NODE C                     â”‚   â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚   â”‚
â”‚  â”‚  Technology: Python 3.10 + FastAPI + Motor (async MongoDB)         â”‚   â”‚
â”‚  â”‚  Port: 8000 (exposed to host)                                      â”‚   â”‚
â”‚  â”‚  Environment:                                                       â”‚   â”‚
â”‚  â”‚    MONGO_URI = mongodb://mongos:27017/speedscale                   â”‚   â”‚
â”‚  â”‚    REDIS_URL = redis://redis:6379                                  â”‚   â”‚
â”‚  â”‚  Responsibilities:                                                  â”‚   â”‚
â”‚  â”‚    â€¢ Route requests to mongos (never directly to shards)           â”‚   â”‚
â”‚  â”‚    â€¢ Implement cache-aside pattern with Redis                      â”‚   â”‚
â”‚  â”‚    â€¢ Auto-seed 2,000 products on first startup                     â”‚   â”‚
â”‚  â”‚    â€¢ ML-powered product recommendations                            â”‚   â”‚
â”‚  â”‚    â€¢ Rate limiting (60 req/min per IP)                             â”‚   â”‚
â”‚  â”‚    â€¢ Health checks and connection pooling                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚                                   â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                                   â”‚
                     â”‚                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      CACHE LAYER (NODE B)              â”‚  â”‚    DATA LAYER (NODE A)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚  â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  âš¡ REDIS CACHE                â”‚    â”‚  â”‚  â”‚  ğŸ—„ï¸  MONGOS ROUTER     â”‚   â”‚
â”‚  â”‚  (cluster-redis-cache)         â”‚    â”‚  â”‚  â”‚  (cluster-mongos)      â”‚   â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚    â”‚  â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚   â”‚
â”‚  â”‚  Image: redis/redis-stack      â”‚    â”‚  â”‚  â”‚  Port: 27017           â”‚   â”‚
â”‚  â”‚  Ports:                         â”‚    â”‚  â”‚  â”‚  Command: mongos       â”‚   â”‚
â”‚  â”‚    6379: Redis server           â”‚    â”‚  â”‚  â”‚  Config DB:            â”‚   â”‚
â”‚  â”‚    8001: RedisInsight UI        â”‚    â”‚  â”‚  â”‚    configReplSet/...   â”‚   â”‚
â”‚  â”‚  Cache Strategy:                â”‚    â”‚  â”‚  â”‚  Responsibilities:     â”‚   â”‚
â”‚  â”‚    â€¢ Search: 60s TTL            â”‚    â”‚  â”‚  â”‚    â€¢ Query routing     â”‚   â”‚
â”‚  â”‚    â€¢ Products: 300s TTL         â”‚    â”‚  â”‚  â”‚    â€¢ Result merging    â”‚   â”‚
â”‚  â”‚    â€¢ Similar: 120s TTL          â”‚    â”‚  â”‚  â”‚    â€¢ Load balancing    â”‚   â”‚
â”‚  â”‚  Performance:                   â”‚    â”‚  â”‚  â”‚    â€¢ Auto-sharding     â”‚   â”‚
â”‚  â”‚    â€¢ Latency: 5-15ms            â”‚    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚    â€¢ Hit rate: 70-85%           â”‚    â”‚  â”‚              â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚              â”‚                 â”‚
â”‚                                        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚  â”‚  ğŸ“‹ CONFIG SERVERS     â”‚   â”‚
â”‚  â”‚  ğŸ® REDIS COMMANDER            â”‚    â”‚  â”‚  â”‚  (3 nodes)             â”‚   â”‚
â”‚  â”‚  (cluster-redis-ui)            â”‚    â”‚  â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚   â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚    â”‚  â”‚  â”‚  â€¢ config-server-1     â”‚   â”‚
â”‚  â”‚  Port: 8081                    â”‚    â”‚  â”‚  â”‚  â€¢ config-server-2     â”‚   â”‚
â”‚  â”‚  Purpose: Inspect cache keys   â”‚    â”‚  â”‚  â”‚  â€¢ config-server-3     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚  â”‚  Replica Set:          â”‚   â”‚
â”‚                                        â”‚  â”‚  â”‚    configReplSet       â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  Stores:               â”‚   â”‚
                                            â”‚  â”‚    â€¢ Chunk ranges       â”‚   â”‚
                                            â”‚  â”‚    â€¢ Shard locations    â”‚   â”‚
                                            â”‚  â”‚    â€¢ Database metadata  â”‚   â”‚
                                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                            â”‚              â”‚                 â”‚
                                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                            â”‚  â”‚  SHARDED DATA TIER     â”‚   â”‚
                                            â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚   â”‚
                                            â”‚  â”‚                        â”‚   â”‚
                                            â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
                                            â”‚  â”‚  â”‚  SHARD 1         â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  (shard1ReplSet) â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  Primary:        â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚   shard1-node1   â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  Secondaries:    â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚   shard1-node2   â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚   shard1-node3   â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  Data Range:     â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚   ~50% products  â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚   (hash % 2 = 0) â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  Volume:         â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚   3Ã— redundancy  â”‚ â”‚   â”‚
                                            â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
                                            â”‚  â”‚                        â”‚   â”‚
                                            â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
                                            â”‚  â”‚  â”‚  SHARD 2         â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  (shard2ReplSet) â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  Primary:        â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚   shard2-node1   â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  Secondaries:    â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚   shard2-node2   â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚   shard2-node3   â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  Data Range:     â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚   ~50% products  â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚   (hash % 2 = 1) â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚  Volume:         â”‚ â”‚   â”‚
                                            â”‚  â”‚  â”‚   3Ã— redundancy  â”‚ â”‚   â”‚
                                            â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
                                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            NETWORK & PERSISTENCE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸŒ Network: mongo-shard-network (bridge)                                   â”‚
â”‚     â€¢ All 15 containers on same Docker bridge network                       â”‚
â”‚     â€¢ Internal DNS: mongo:27017, redis:6379, etc.                           â”‚
â”‚     â€¢ Isolation: No external access except exposed ports                    â”‚
â”‚                                                                             â”‚
â”‚  ğŸ’¾ Persistent Volumes (9 total):                                           â”‚
â”‚     â€¢ config1_data, config2_data, config3_data                              â”‚
â”‚     â€¢ shard1_node1_data, shard1_node2_data, shard1_node3_data               â”‚
â”‚     â€¢ shard2_node1_data, shard2_node2_data, shard2_node3_data               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         REQUEST FLOW (Example)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1ï¸âƒ£  User searches "Gaming Laptop" at http://localhost:3000                 â”‚
â”‚      â†“                                                                      â”‚
â”‚  2ï¸âƒ£  Frontend â†’ GET http://localhost:3000/backend/api/search?query=Gaming   â”‚
â”‚      â†“                                                                      â”‚
â”‚  3ï¸âƒ£  Nginx proxy â†’ http://cluster-api-gateway:8000/api/search               â”‚
â”‚      â†“                                                                      â”‚
â”‚  4ï¸âƒ£  FastAPI checks Redis: GET "search:gaming laptop"                       â”‚
â”‚      â”œâ”€ HIT? â†’ Return cached result (5ms) âš¡                                â”‚
â”‚      â””â”€ MISS? â†’ Continue to step 5                                         â”‚
â”‚      â†“                                                                      â”‚
â”‚  5ï¸âƒ£  FastAPI â†’ mongos:27017: db.products.find({name: /Gaming Laptop/i})     â”‚
â”‚      â†“                                                                      â”‚
â”‚  6ï¸âƒ£  Mongos analyzes query:                                                 â”‚
â”‚      â”œâ”€ Not indexed on 'name' â†’ Full collection scan                       â”‚
â”‚      â”œâ”€ Broadcast to ALL shards (parallel queries)                         â”‚
â”‚      â”œâ”€ shard1-node1 (primary) â†’ finds 5 products                          â”‚
â”‚      â””â”€ shard2-node1 (primary) â†’ finds 5 products                          â”‚
â”‚      â†“                                                                      â”‚
â”‚  7ï¸âƒ£  Mongos merges results â†’ 10 products total                              â”‚
â”‚      â†“                                                                      â”‚
â”‚  8ï¸âƒ£  FastAPI writes to Redis: SET "search:gaming laptop" [...] EX 60        â”‚
â”‚      â†“                                                                      â”‚
â”‚  9ï¸âƒ£  Response to Frontend:                                                  â”‚
â”‚      {                                                                      â”‚
â”‚        "source": "MONGODB_DISK ğŸ¢ (Python)",                                â”‚
â”‚        "time": "120ms",                                                     â”‚
â”‚        "cached": false,                                                     â”‚
â”‚        "count": 10,                                                         â”‚
â”‚        "data": [...]                                                        â”‚
â”‚      }                                                                      â”‚
â”‚      â†“                                                                      â”‚
â”‚  ğŸ” Next search within 60s â†’ Redis cache (step 4 HIT) â†’ 5ms response       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FAILOVER SCENARIO                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  âŒ Failure: shard1-node1 (primary) crashes                                 â”‚
â”‚      â†“                                                                      â”‚
â”‚  â±ï¸  Replica set detects failure (~5 seconds)                               â”‚
â”‚      â†“                                                                      â”‚
â”‚  ğŸ—³ï¸  Election starts: shard1-node2 vs shard1-node3                          â”‚
â”‚      â”œâ”€ Majority vote: 2/2 remaining nodes                                 â”‚
â”‚      â””â”€ Winner: shard1-node2 becomes new primary (~10 seconds)             â”‚
â”‚      â†“                                                                      â”‚
â”‚  âœ… Mongos updates routing table                                            â”‚
â”‚      â”œâ”€ Shard 1: shard1-node2 (new primary)                                â”‚
â”‚      â””â”€ Shard 2: shard2-node1 (unchanged)                                  â”‚
â”‚      â†“                                                                      â”‚
â”‚  ğŸ‰ Queries continue with 0 data loss                                       â”‚
â”‚      â”œâ”€ Downtime: 10-15 seconds                                            â”‚
â”‚      â”œâ”€ Data: Fully intact (replicated on node2 + node3)                   â”‚
â”‚      â””â”€ Cache: Unaffected (Redis still serving)                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Performance Characteristics

| Operation | Cold (MongoDB) | Hot (Redis) | Speedup |
|-----------|----------------|-------------|---------|
| Product search (2K docs) | 100-150ms | 5-15ms | 10-20x |
| Product search (1M docs) | 300-500ms | 5-15ms | 30-50x |
| Product detail | 80-120ms | 3-10ms | 15-30x |
| Similar products (ML) | 120-180ms | 8-15ms | 15-20x |

## Data Distribution (2,000 products)

```
Shard 1: ~1,000 products (hash(_id) % 2 == 0)
â”œâ”€ Replica: shard1-node1 (primary)
â”œâ”€ Replica: shard1-node2 (secondary)
â””â”€ Replica: shard1-node3 (secondary)

Shard 2: ~1,000 products (hash(_id) % 2 == 1)
â”œâ”€ Replica: shard2-node1 (primary)
â”œâ”€ Replica: shard2-node2 (secondary)
â””â”€ Replica: shard2-node3 (secondary)

Total redundancy: 6,000 document copies (3 per shard Ã— 2 shards)
```

## Resource Allocation

| Service | CPU | RAM | Disk |
|---------|-----|-----|------|
| Frontend | 0.1% | 50MB | - |
| API Gateway | 1-3% | 200MB | - |
| Redis | 0.5% | 150MB | - |
| Mongos | 1-2% | 150MB | - |
| Config Servers (3) | 1-2% | 300MB | 1GB |
| Shard 1 Nodes (3) | 2-5% | 600MB | 5GB |
| Shard 2 Nodes (3) | 2-5% | 600MB | 5GB |
| **TOTAL** | **10-20%** | **~2.5GB** | **11GB** |
